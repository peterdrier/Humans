@model Humans.Web.Models.OnboardingReviewDetailViewModel
@{
    ViewData["Title"] = string.Format(Localizer["OnboardingReview_DetailTitle"].Value, Model.DisplayName);
}

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a asp-action="Index">@Localizer["OnboardingReview_Title"]</a></li>
        <li class="breadcrumb-item active" aria-current="page">@Model.DisplayName</li>
    </ol>
</nav>

<vc:temp-data-alerts />

<div class="row">
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header">@Localizer["OnboardingReview_ProfileSummary"]</div>
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <vc:user-avatar profile-picture-url="@Model.ProfilePictureUrl"
                                    display-name="@Model.DisplayName"
                                    size="64"
                                    css-class="me-3" />
                    <div>
                        <h4 class="mb-0">@Model.DisplayName</h4>
                        <p class="text-muted mb-0">@Model.Email</p>
                    </div>
                </div>

                <dl class="row mb-0">
                    <dt class="col-sm-4">@Localizer["OnboardingReview_LegalName"]</dt>
                    <dd class="col-sm-8">@Model.FirstName @Model.LastName</dd>

                    @if (!string.IsNullOrEmpty(Model.City))
                    {
                        <dt class="col-sm-4">@Localizer["Profile_Location"]</dt>
                        <dd class="col-sm-8">@Model.City, @Model.CountryCode</dd>
                    }

                    <dt class="col-sm-4">@Localizer["AdminHuman_MembershipTier"]</dt>
                    <dd class="col-sm-8">
                        @Model.MembershipTier
                        @if (Model.HasPendingApplication)
                        {
                            <span class="badge bg-info ms-1">@Localizer["OnboardingReview_HasApplication"]</span>
                        }
                    </dd>

                    <dt class="col-sm-4">@Localizer["OnboardingReview_Consents"]</dt>
                    <dd class="col-sm-8">@Model.ConsentCount / @Model.RequiredConsentCount @Localizer["OnboardingReview_Signed"]</dd>

                    <dt class="col-sm-4">@Localizer["Admin_Joined"]</dt>
                    <dd class="col-sm-8">@Model.ProfileCreatedAt.ToString("d MMMM yyyy")</dd>
                </dl>
            </div>
        </div>

        @if (!string.IsNullOrEmpty(Model.ApplicationMotivation))
        {
            <div class="card mb-4">
                <div class="card-header">@Localizer["OnboardingReview_ApplicationMotivation"]</div>
                <div class="card-body">
                    <p class="mb-0" style="white-space: pre-wrap;">@Model.ApplicationMotivation</p>
                </div>
            </div>
        }

        @if (!string.IsNullOrEmpty(Model.ConsentCheckNotes))
        {
            <div class="card mb-4">
                <div class="card-header">@Localizer["OnboardingReview_PreviousNotes"]</div>
                <div class="card-body">
                    <p class="mb-0" style="white-space: pre-wrap;">@Model.ConsentCheckNotes</p>
                </div>
            </div>
        }

        <vc:profile-card user-id="@Model.UserId" view-mode="@Humans.Web.ViewComponents.ProfileCardViewMode.Admin" />
    </div>

    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">@Localizer["OnboardingReview_Actions"]</div>
            <div class="card-body">
                @if (Model.ConsentCheckStatus == Humans.Domain.Enums.ConsentCheckStatus.Pending ||
                     Model.ConsentCheckStatus == Humans.Domain.Enums.ConsentCheckStatus.Flagged)
                {
                    <form asp-action="Clear" asp-route-userId="@Model.UserId" method="post" class="mb-3">
                        @Html.AntiForgeryToken()
                        <div class="mb-2">
                            <textarea name="notes" class="form-control" rows="2" placeholder="@Localizer["OnboardingReview_NotesPlaceholder"].Value"></textarea>
                        </div>
                        <button type="submit" class="btn btn-success w-100"
                                data-confirm="@Localizer["OnboardingReview_ClearConfirm"].Value">
                            <i class="fa-solid fa-check me-1"></i> @Localizer["OnboardingReview_ClearButton"]
                        </button>
                        <div class="form-text">@Localizer["OnboardingReview_ClearHelp"]</div>
                    </form>

                    <hr />

                    @if (Model.ConsentCheckStatus != Humans.Domain.Enums.ConsentCheckStatus.Flagged)
                    {
                        <form asp-action="Flag" asp-route-userId="@Model.UserId" method="post">
                            @Html.AntiForgeryToken()
                            <div class="mb-2">
                                <textarea name="notes" class="form-control" rows="2" placeholder="@Localizer["OnboardingReview_FlagReasonPlaceholder"].Value"></textarea>
                            </div>
                            <button type="submit" class="btn btn-danger w-100"
                                    data-confirm="@Localizer["OnboardingReview_FlagConfirm"].Value">
                                <i class="fa-solid fa-flag me-1"></i> @Localizer["OnboardingReview_FlagButton"]
                            </button>
                        </form>
                    }

                    <hr />

                    <form asp-action="Reject" asp-route-userId="@Model.UserId" method="post">
                        @Html.AntiForgeryToken()
                        <div class="mb-2">
                            <textarea name="reason" class="form-control" rows="2" placeholder="@Localizer["OnboardingReview_RejectReasonPlaceholder"].Value"></textarea>
                        </div>
                        <button type="submit" class="btn btn-outline-danger w-100"
                                data-confirm="@Localizer["OnboardingReview_RejectConfirm"].Value">
                            <i class="fa-solid fa-ban me-1"></i> @Localizer["OnboardingReview_RejectButton"]
                        </button>
                        <div class="form-text">@Localizer["OnboardingReview_RejectHelp"]</div>
                    </form>
                }
                else if (Model.ConsentCheckStatus == Humans.Domain.Enums.ConsentCheckStatus.Cleared)
                {
                    <div class="text-success text-center">
                        <i class="fa-solid fa-circle-check fa-2x mb-2"></i>
                        <p>@Localizer["OnboardingReview_AlreadyCleared"]</p>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
